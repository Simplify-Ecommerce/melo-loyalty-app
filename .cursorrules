# Cursor Rules para Shopify App Development

## Reglas para Theme App Extensions

### 1. NO usar `{% stylesheet %}` en App Blocks
**Error común:** Usar `{% stylesheet %}` dentro de archivos `.liquid` de app blocks causa el error: "Cannot use stylesheet tag in app blocks"

**Solución:**
- Crear archivos CSS separados en la carpeta `assets/`
- Referenciar el CSS en el schema del bloque usando `"stylesheet": "nombre-archivo.css"`
- NO usar `{% stylesheet %}` dentro de archivos `.liquid` de app blocks o snippets

**Ejemplo correcto:**
```liquid
{% schema %}
{
  "name": "Mi Bloque",
  "stylesheet": "mi-estilo.css",
  ...
}
{% endschema %}
```

**Ejemplo incorrecto:**
```liquid
{% stylesheet %}
  .mi-clase { color: red; }
{% endstylesheet %}
```

### 2. NO usar `{% javascript %}` en App Blocks
**Error común:** Usar `{% javascript %}` dentro de archivos `.liquid` de app blocks causa el error: "Cannot use javascript tag in app blocks"

**Solución:**
- Usar `<script>` de HTML estándar dentro del archivo `.liquid`
- O crear archivos JavaScript separados en `assets/` y referenciarlos en el schema con `"javascript": "nombre-archivo.js"`
- Si necesitas usar tags Liquid dentro del JavaScript, usar `<script>` con el código JavaScript directamente

**Ejemplo correcto:**
```liquid
<script>
  const customerId = '{{ customer.id }}';
  // código JavaScript aquí
</script>
```

**Ejemplo incorrecto:**
```liquid
{% javascript %}
  const customerId = '{{ customer.id }}';
{% endjavascript %}
```

### 3. Tamaño de archivos JavaScript
**Error común:** Archivos JavaScript que exceden 10KB causan el error: "The file size for 'archivo.js' exceeds the configured threshold (10000 B)"

**Solución:**
- Mantener archivos JavaScript bajo 10KB (comprimidos)
- Si es necesario, dividir el código en múltiples archivos
- Minificar el código cuando sea posible
- Mover código repetitivo a funciones reutilizables

### 4. Tags Liquid dentro de JavaScript
**Error común:** Mezclar tags Liquid (`{% if %}`, `{% endif %}`) dentro de código JavaScript minificado causa errores de sintaxis

**Solución:**
- Definir variables JavaScript usando Liquid ANTES del código JavaScript
- Usar constantes JavaScript en lugar de tags Liquid dentro del código
- Mantener el código JavaScript legible cuando se usan tags Liquid

**Ejemplo correcto:**
```liquid
<script>
  {% if customer %}
  const IS_LOGGED_IN = true;
  const CUSTOMER_ID = '{{ customer.id }}';
  {% else %}
  const IS_LOGGED_IN = false;
  {% endif %}
  
  // Ahora usar IS_LOGGED_IN y CUSTOMER_ID en el código JavaScript
  if (IS_LOGGED_IN) {
    // código
  }
</script>
```

**Ejemplo incorrecto:**
```liquid
<script>
  function checkUser() {
    {% if customer %}
      return true;
    {% else %}
      return false;
    {% endif %}
  }
</script>
```

## Reglas para React Router / Shopify App Backend

### 5. NO usar `json` de `@react-router/node`
**Error común:** Importar `json` de `@react-router/node` causa el error: "The requested module '@react-router/node' does not provide an export named 'json'"

**Solución:**
- Usar `Response.json()` que es la API nativa de JavaScript/Web API
- NO importar `json` de `@react-router/node`
- Usar `Response.json(data, options)` en lugar de `json(data, options)`

**Ejemplo correcto:**
```javascript
export const loader = async ({ request }) => {
  try {
    // código
    return Response.json({ success: true }, { status: 200 });
  } catch (error) {
    return Response.json({ error: error.message }, { status: 500 });
  }
};
```

**Ejemplo incorrecto:**
```javascript
import { json } from "@react-router/node";

export const loader = async ({ request }) => {
  return json({ success: true }, { status: 200 });
};
```

### 6. Manejo de respuestas JSON
**Regla general:**
- Siempre usar `Response.json()` para respuestas JSON
- El segundo parámetro es un objeto con opciones como `{ status: 200 }`
- Para leer JSON del request, usar `await request.json()` (esto sí es correcto)

## Checklist antes de commitear

- [ ] No hay tags `{% stylesheet %}` en archivos `.liquid` de app blocks
- [ ] No hay tags `{% javascript %}` en archivos `.liquid` de app blocks
- [ ] Los archivos JavaScript están bajo 10KB
- [ ] No hay importaciones de `json` de `@react-router/node`
- [ ] Se usa `Response.json()` para todas las respuestas JSON
- [ ] Los tags Liquid están correctamente separados del código JavaScript

## Reglas para Vite y Rutas con Espacios

### 7. Rutas con espacios en el nombre
**Error común:** Si la ruta del proyecto contiene espacios (ej: "Simplify office", "Formulario de Melo"), Vite puede tener problemas con el optimizador de dependencias mostrando errores como: "The file does not exist at ... which is in the optimize deps directory"

**Solución:**
- Limpiar el caché de Vite: `rm -rf node_modules/.vite`
- Asegurarse de que `vite.config.js` tenga configuraciones adecuadas para `optimizeDeps`
- Si el problema persiste, considerar mover el proyecto a una ruta sin espacios (recomendado)
- Alternativamente, usar rutas cortas de Windows (8.3) o crear un symlink

**Configuración recomendada en vite.config.js:**
```javascript
optimizeDeps: {
  include: ["@shopify/app-bridge-react"],
  force: false,
  exclude: [],
},
resolve: {
  preserveSymlinks: false,
},
cacheDir: "node_modules/.vite",
```

**Si el problema persiste:**
1. Mover el proyecto a una ruta sin espacios (ej: `C:/Users/SimplifyOffice/Desktop/FormularioDeMelo/...`)
2. O usar una ruta más corta sin espacios
3. Limpiar caché: `rm -rf node_modules/.vite` y reiniciar el servidor

## Notas adicionales

- Los snippets (archivos en `snippets/`) también NO pueden usar `{% stylesheet %}` o `{% javascript %}`
- Los archivos CSS y JavaScript deben estar en la carpeta `assets/` de la extensión
- El schema del bloque debe referenciar los archivos de assets correctamente
- Para JavaScript inline con Liquid, siempre usar `<script>` de HTML
- **Evitar espacios en las rutas del proyecto** - puede causar problemas con Vite y otras herramientas

